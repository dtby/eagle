<div class="col-xs-12">
  <!-- 状态切换 -->
  <div class="btn-group" role="group" style="margin-bottom: 15px;" aria-label="...">
    <%= link_to "未处理", alert_room_path(@room), class: "btn btn-default #{params['action'] =='alert' ? 'btn-active' : ''}", data: {disable_with: '加载中...'} %>
    <%= link_to "已处理", checked_alert_room_path(@room), class: "btn btn-default #{params['action'] =='checked_alert' ? 'btn-active' : ''}", data: {disable_with: '加载中...'} %>
  </div>
  <!-- 时间查询 -->
  <div class="row">
    <div class="col-sm-12 col-xs-12">
      <%= form_tag alert_room_path(@room), method: :get, class: 'form-horizontal', role: "form" do %>
        <div class="form-group col-sm-3">
          <div id="datetimepicker1" class="input-append date">
             <%= text_field_tag :start_time, params[:start_time], 'data-format': "dd/MM/yyyy hh:mm:ss", placeholder: "开始时间", required: true%>
              <span class="add-on">
                <i data-time-icon="glyphicon glyphicon-time" data-date-icon="glyphicon glyphicon-calendar">
                </i>
              </span>
          </div>
        </div>
        <div class="form-group col-sm-3">
          <div id="datetimepicker2" class="input-append date">
            <%= text_field_tag :end_time, params[:end_time], 'data-format': "dd/MM/yyyy hh:mm:ss", placeholder: "截止时间", required: true %>
              <span class="add-on">
                <i data-time-icon="glyphicon glyphicon-time" data-date-icon="glyphicon glyphicon-calendar">
                </i>
              </span>
          </div>
        </div>
        <%= submit_tag "搜索", class: "btn btn-xs btn-default" %>
      <% end %>
    </div>
  </div>
</div>

<div class="col-xs-12">
  <div class="table-responsive">
    <table id="sample-table-1" class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th class="text-center">告警名称</th>
          <th class="text-center">Point ID</th>
          <th class="text-center">告警状态</th>
          <th class="text-center">告警时间</th>
          <th class="text-center">告警处理</th>
        </tr>
      </thead>
      <tbody>
        <% @point_alarms.each do |point_alarm|%>
          <tr>
            <td class="text-center"><%= point_alarm.try(:point).try(:name) %></td>
            <td class="text-center"><%= point_alarm.try(:point).try(:point_index) %></td>
            <td class="text-center"><%= point_alarm.state %></td>
            <td class="text-center"><%= point_alarm.created_at.strftime("%Y-%m-%d %H:%M:%S") %></td>
            <td class="text-center">
              <% unless point_alarm.is_checked %>
                <%= link_to "未处理", checked_point_alarm_path(point_id: point_alarm.point_id, room_id: params[:id]), method: :patch, data: {confirm: '确认处理该警告！'} %>
              <% else %>
                已处理
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <%= will_paginate @point_alarms, renderer: BootstrapPagination::Rails  %>
  </div>
</div>

<script type="text/javascript">
  $(function() {
    $('#datetimepicker1, #datetimepicker2').datetimepicker({
       collapse: false
    });
  });
</script>