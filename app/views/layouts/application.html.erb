<!DOCTYPE html>
<html>
<head>
  <title>iGrid监控平台</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= stylesheet_link_tag    "#{controller.controller_name}", media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag "#{controller.controller_name}", 'data-turbolinks-track' => true %>
  <script type="text/javascript" src="http://localhost:3000/faye/client.js"></script>
  <%= Gon::Base.render_data %>
  <%= csrf_meta_tags %>
  <%= favicon_link_tag "favicon_logo.ico" %>
</head>

	<body>
		<div id="wrapper">
			<!-- 左侧导航栏部分 -->
			<%= render partial: "/share/left_bar" %>

			<!-- 右侧内容页 -->
			<div id="page-wrapper" class="gray-bg">
				<!-- 顶部导航 -->
				<%= render partial: "/share/top_bar" %>

				<!-- 右侧中间内容部分 -->
				<div class="row wrapper eagle-content <%= controller.controller_path.gsub('/','__') + '__' + controller.action_name %>">
					<%= yield %>
				</div>

				<!-- 页脚 -->
				<%= render partial: "/share/footer" %>

				<!-- 皮肤及设置 -->
				<%#= render partial: "/share/setting" %>
			</div>
      <div id="alarms-window" class="panel alarms-window">
        <div class="panel-heading">告警信息</div>
        <div class="panel-body"></div>
      </div>
      <audio id="alarm-audio"><source src="<%= audio_path 'alarm.mp3'%>"></audio>
		</div>
    <%= yield :scripts %>
    <script type='text/javascript'>
      var client = new Faye.Client('http://m.igridtotalsolution.com/faye');
      var subscription = client.subscribe('/notify/alarms', function(message) {
        let _audio = $('#alarm-audio')[0];
        $('#alarms-window').show('slow');
        $('#alarms-window > .panel-body').text(message.content);
        _audio.play();
        setTimeout(function(){
          _audio.pause();
          $('#alarms-window').hide('slow');
        }, 5000);
      });
    </script>
	</body>
  
</html>
