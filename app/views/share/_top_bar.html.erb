<div class="row fixed-nav">
	<nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0; background: rgba(10,20,23,255);">
		<!-- 左侧导航栏收起按钮 -->
		<div class="navbar-header" style="margin-left: 20px;">
			<a class="navbar-minimalize minimalize-styl-2 btn btn-primary" href="#" style="position: absolute;left: 300px;"><i class="fa fa-bars"></i> </a>
			<%= link_to image_tag('logo.png'), root_path, style: "margin-top: 18px; margin-left: 20px; display: block;" %>
		</div>
		<!-- 左侧导航栏收起按钮  end-->
		<!-- 右上角消息提示部分 -->
		<ul class="nav ace-nav navbar-top-links navbar-right">
			<!-- 机房选择 -->
			<li>
				<%= link_to alert_room_path(@room), class: "js-ref-page", 'data-url': refersh_alert_room_path(@room) do %>
				  告警 <span class="badge badge-danger" id="js-alert-num"><%= @alerts.length %></span>
				<% end %>
			</li>
			<li class="dropdown">
				<a id="roomSelectBtn" class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
					<i class="fa fa-home fa-lg"></i>机房<b class="caret"></b>
				</a>
				<!-- <ul class="dropdown-menu">
					<%# current_user.rooms.each do |room| %>
						<li><%#= link_to room.name, room_path(room) %></li>
					<%# end %>
				</ul> -->
			</li><!-- 机房选择end -->
			<li>
				<%= link_to "javascript: void(0)" do %>
					<i class="fa fa-user"></i> <%= current_user.name %>
				<% end %>
			</li>
			<li>
				<%= link_to destroy_user_session_path, method: :delete do %>
					<i class="fa fa-sign-out"></i> 退出
				<% end %>
			</li>
		</ul>
		<!-- 右上角消息提示部分 end-->
	</nav>
</div>

<div id="roomSelect" class="modal fade rooms-modal" aria-hidden="true" style="margin-top: 80px;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title"><span class="text-primary">区域、机房切换</h3>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-lg-12">
          	<form action="">
	          	<div class="form-group">
	              <div class="input-group" style="width: 100%;">
	                <%= select_tag :area, options_from_collection_for_select(current_user.areas.distinct, "id", "name", ''), class: "form-control", style: "width:100%", tabindex: "4", prompt: "选择区域", "data-placeholder" => "选择区域", id: "areaOptions" %>
	              </div>
	            </div>
	            <div class="form-group">
	              <div id="roomsDiv" class="input-group" style="width: 100%;">
	                <%= select_tag :room, options_from_collection_for_select(current_user.rooms, "id", "name", ''), class: "form-control", style: "width:100%", tabindex: "4", prompt: "选择机房", "data-placeholder" => "选择机房", id: "roomSO" %>
	              </div>
	            </div>
	            <div class="text-center"><button class="btn sub-btn btn-primary" type="submit"><strong>提交</strong></button></div>
	          </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
	clearInterval(alarm_refresher);
  var url = $(".js-ref-page").data('url');
  function refreshPartial() {
	  $.ajax({
	    url: url,
	    type: 'get',
      success: function (data, status) {
	    	counter = data.result
	    	for (idx in counter) {
	    		$("#system_"+counter[idx].system_id).html(counter[idx].system_count)
	    		$("#sub_system_"+counter[idx].sub_system_id).html(counter[idx].sub_system_count)
	    		$("#device_"+counter[idx].device_id).html(counter[idx].device_count)
	    	}
	    }

	 	});
	}
	var alarm_refresher = setInterval(refreshPartial, 5000)

	var roomOptions = ""
	<% current_user.rooms.each do |room| %>
		roomOptions += "<option value='<%= room.id %>' data-area='<%= room.area_id %>'><%= room.name %></options>"
	<% end %>

	$(function(){
		$("#roomSelectBtn").click(function(){
			$('#roomSelect').modal('show');
		});

		$("#areaOptions").change(function(){
			$("#roomSO").html(roomOptions);
			var area_id = $(this).val()
			$("#roomSO option").each(function(){
				if($(this).val() && area_id != $(this).attr("data-area")){
					$(this).remove();
				}
			});
			$("#roomSO").prepend("<option>选择机房</option>");
		});

		$("#roomSO").change(function(){
			if($(this).val() != ""){
				location.href = '/rooms/' + $(this).val();
			}
		});

	});
	
</script>
