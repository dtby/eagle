<div class="clearfix power__ups">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body text-center">
        <h2><%= device.name %></h2>
      </div>
    </div>
  </div>
  
  <div class="col-md-12">
    <div class="col-md-8 mblock ups-up ups-up-left">
    <div class="row">
      <div class="col-xs-4 p-r"></div>
      <div class="col-xs-8 p-l">
        <%=image_tag"power-ups2.jpg",width:"65%", height: "90%", id: 'ups_img'%>
        <!-- 左侧表格1 -->
        <div class="table-responsive table-left1">
          <% if @points['市电输入'].present? %>
            <%= render partial: "devices/share/table", locals: { title: "市电输入", points: @points["市电输入"], exclude_points: exclude_points["市电输入"] } %>
          <% elsif @points['市电输出'].present? %>
            <%= render partial: "devices/share/table", locals: { title: "市电输出", points: @points["市电输出"], exclude_points: exclude_points["市电输出"] } %>
          <% end %>
        </div>
        <!-- 右侧表格 -->
        <% if @points["UPS输出"].present? %>
          <div class="table-responsive table-right">
            <%= render partial: "devices/share/table", locals: { title: "UPS输出", points: @points["UPS输出"], exclude_points: exclude_points["UPS输出"] } %>
          </div>
        <% end %>
        <!-- 下部表格 -->
        <div class="table-responsive table-bottom">
          <% if @points['电池模块'].present? %>
            <%= render partial: "devices/share/table", locals: { title: "电池模块", points: @points["电池模块"], exclude_points: exclude_points["电池模块"] } %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
  
  <% if @points["告警"].present? %>
    <div class="col-md-4 ups-up ups-up-right">
      <div class="panel panel-default warn-info">
        <div class="panel-heading text-center"><h4>报警信息</h4></div>
        <div class="panel-body" >
          <div class="content">
            <% @points["告警"].each do |key, value| %>
              <div class="col-xs-6" style="margin-bottom: 10px;">
                <span class="warning-name"><%= key %></span>
                <span class="warning-icon"><%= warning_status value %></span>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>  
  </div>
  
  <% if @load_factor %>
  <div class="col-md-12">
    <div class="mblock part-bar">
      <span class="text-muted">输出负载率</span>
      <div id="ups_bar" style="width: 100%;"></div>
    </div>
  </div>
  <% end %>

  <% if  @points["表格"].present? %>
  <div class="col-md-12">
    <div class="mblock part-pie">
      <div id="ups_bar2" style="width: 100%;"></div>
    </div>
  </div>
  <% end %>
</div>

<script type="text/javascript">
  // 路径配置
  require.config({
    paths: {
      echarts: '/assets/echarts'
    }
  });
  <% if @load_factor %>
  // 条形图
  require(
    [
    'echarts',
      'echarts/chart/bar', // 使用柱状图就加载bar模块，按需加载
      ],
      function (bar) {
      // 基于准备好的dom，初始化echarts图表
      var upsBar = bar.init(document.getElementById('ups_bar'), 'macarons');

      var option = {
        grid : {
          y : 5,
          x2 : 5,
          y2 : 5,
          x : 5
        },
        tooltip : {
          trigger: 'axis'
        },
        xAxis : [
        {
          type : 'category',
          data : ['','','','','','','','','','','','','','','','','','','','','','','','']
        }
        ],
        yAxis : [
        {
          type : 'value'
        }
        ],
        series : [
        {
          name:'负载率',
          type:'bar',
          itemStyle:{
            normal:{
              color:'#00cae1'
            }
          },
          data:[7.0, 16.9, 40.0, 12.2, 32.6, 20.0, 30.4, 18.6, 22.2, 3.3,2.0, 4.9, 7.0, 23.2, 23.2, 25.6, 76.7, 135.6, 25.6, 76.7, 32.6, 20.0, 6.4, 3.3],
        }
        ],
      };
      // 为echarts对象加载数据
      upsBar.setOption(option);
    }
    );
  <% end %>
  <% if @device_consume.present? %>
  // 条形图
  require(
    [
    'echarts',
    'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
    ],
    function (line) {
      // 基于准备好的dom，初始化echarts图表
      var upsBar2 = line.init(document.getElementById('ups_bar2'), 'macarons');

      var option = {
        grid: { y: 55, x2: 5, y2: 25, x: 5 },
        tooltip: { trigger: 'axis' },
        legend: {
          x: 'right',
          data:[
            <% @device_consume.keys.each do |key| %>
              "<%= key %>",
            <% end %>
          ]
        },
        xAxis : [
        {
          type : 'category',
          data : [
            <% @device_consume.first.second.each do |item| %>
              "<%= item.created_at.strftime('%F %H:%M') %>",
            <% end %>
          ]
        }
        ],
        yAxis : [{ type : 'value' }],
        series : [
        <% @device_consume.each do |key, items| %>
          {
            name:'<%= key %>',
            type:'line',
            data:[
              <% items.each do |item|%>
                <%= item.point_value %>,
              <% end %>
            ],
          },
        <% end %>
        ]
      };
      // 为echarts对象加载数据
      upsBar2.setOption(option);
    }
  );
  <% end %>
</script>
