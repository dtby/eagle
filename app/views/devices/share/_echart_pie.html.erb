<!--输出负载率 -->
<script type="text/javascript">
    //保留一位小数
    var format_number = function(i){
      num = new Number(i)
      return num.toFixed(1)
    }

    // 路径配置
    require.config({
      paths: {
        echarts: '/assets/echarts'
      }
    });

    // 使用
    require(
      [
      'echarts',
        'echarts/chart/pie' // 使用柱状图就加载bar模块，按需加载
        ],
        function (ec) {
        // 基于准备好的dom，初始化echarts图表
        var myChart = ec.init(document.getElementById('load1'));
        var labelTop = {
          normal : {
            label : {
              show : true,
              position : 'center',
              formatter : '{b}',
              textStyle: {
                baseline : 'top',
                fontSize: 12
              }
            },
            labelLine : {
              show : false
            }
          }
        };
        var labelFromatter = {
          normal : {
            label : {
              formatter : function (params){
                return format_number(100 - params.value) + 'A'
              },
              textStyle: {
                baseline : 'bottom',
                fontSize: 24,
              }
            }
          },
        }
        var labelBottom = {
          normal : {
            color: '#ccc',
            label : {
              show : true,
              position : 'center'
            },
            labelLine : {
              show : false
            }
          },
          emphasis: {
            color: 'rgba(0,0,0,0)'
          }
        };
        var radius = [45, 50];
        var  option = {

          series : [
            <% unless exclude_points["电流"] && exclude_points["电流"].include?("A相电流") %>
              <% if points["电流"].present? %>
                {
                  type : 'pie',
                  center : ['15%', '50%'],
                  radius : radius,
                  x: '30%', // for funnel
                  itemStyle : labelFromatter,
                  data : [
                    {name:'other', value:<%= 100 - points["电流"]["A相电流"].to_i %>, itemStyle : labelBottom},
                    {name:'A相电流', value:<%= points["电流"]["A相电流"].to_i %>,itemStyle : labelTop}
                  ]
                },
              <% end %>
            <% end %>
            <% unless exclude_points["电流"] && exclude_points["电流"].include?("B相电流") %>
              <% if points["电流"].present? %>
                {
                  type : 'pie',
                  center : ['50%', '50%'],
                  radius : radius,
                  x:'50%', // for funnel
                  itemStyle : labelFromatter,
                  data : [
                    {name:'other', value:<%= 100 - points["电流"]["B相电流"].to_i %>, itemStyle : labelBottom},
                    {name:'B相电流', value:<%= points["电流"]["B相电流"].to_i %>,itemStyle : labelTop}
                  ]
                },
              <% end %>
            <% end %>
            <% unless exclude_points["电流"] && exclude_points["电流"].include?("C相电流") %>
              <% if points["电流"].present? %>
                {
                  type : 'pie',
                  center : ['85%', '50%'],
                  radius : radius,
                  x:'70%', // for funnel
                  itemStyle : labelFromatter,
                  data : [
                    {name:'other', value:<%= 100 - points["电流"]["C相电流"].to_i %>, itemStyle : labelBottom},
                    {name:'C相电流', value:<%= points["电流"]["C相电流"].to_i %>,itemStyle : labelTop}
                  ]
                },
              <% end %>
            <% end %>
        ]
      };
        // 为echarts对象加载数据
        myChart.setOption(option);
    }
  );
</script> 